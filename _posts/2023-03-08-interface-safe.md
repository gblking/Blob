---
layout: post
title: 保证接口数据安全方案
categories: safe
tags: [数据安全]
excerpt: 大数据时代，人们越来越重视个人的信息安全，作为互联网行业的我们，对数据安全更加关注，在日常开发中，如何保证数据的安全性呢？  
---

## 前言  
大数据时代，人们越来越重视个人的信息安全，作为互联网行业的我们，对数据安全同样特别关注，那么在日常开发中，如何保证数据的安全性呢？  
个人觉得，保证接口数据安全的过程，主要体现在这几个方面：  
1. 数据传输过程中的安全；  
2. 数据到达服务端，如何识别数据；  
3. 数据存储安全性；  


<center style="font-weight: bold;color:#4595d5;">先来个大图镇楼</center>
![1]({{ site.url }}{{site.baseurl}}/assets/images/post/20230308/01.png)  

## 数据加密  
数据加密的目的是防止明文传输。  

**数据如何加密？**  
- 哈希算法：MD5  
- 对称加密算法：AES  
- 非对称加密算法：RSA、SM2  
![2]({{ site.url }}{{site.baseurl}}/assets/images/post/20230308/02.png)   


## 数据加签验签  
数据报加签验签，是保证数据传输安全的常用手段，它可以保证数据在传输过程中不被篡改、数据完整无缺失。  

**什么是加签验证？**  
- `加签：`用Hash算法将原始请求参数生成报文摘要，然后用私钥对该摘要进行加密，就得到了该报文的数字签名，这个过程称之为加签。把数字签名和报文原文传给接收方。  

- `验签：`接收方拿到原始报文和数字签名，用同一个算法(比如都使用MD5)对报文加密生成摘要A，用对方提供的公钥对数字签名进行解密，得到摘要B，比对摘要A和摘要B是否相同，从而得到报文是否被篡改过。  

![3]({{ site.url }}{{site.baseurl}}/assets/images/post/20230308/03.png) 

密钥加解密是否就一定安全呢？ 答案自然是否定的，比如下图场景：  
![4]({{ site.url }}{{site.baseurl}}/assets/images/post/20230308/04.png)     

- C 将 A 提供给B的公钥进行拦截，将公钥替换成 C 自己的公钥并提供给 B  
- C 截取 A 传给B的数据，用 A 提供的公钥进行解密
- C 对截取并解密的数据进行篡改
- C 使用自己的私钥对新数据进行加密，并传给 B  
- B 使用 C 提供的公钥进行解密，得到的数据为 C 的数字，而非 A 提供的数据  

基于上述场景的不安全性，新出了个`数字证书`方式，即：公钥证书体制，CA中心用自己的私钥，对信息发送者的公钥和相关信息一起加密，生成"数字证书"。  
  
    

使用方式：    

| 非对称加密、生成密钥对 | 公钥 | 私钥 |
| :----: | :----: | :----: |
| 用于保密信息 | 公钥加密 | 私钥解密 |
| 用于数字签名 | 公钥解密 | 私钥加密 |
| 数字证书 | 对公钥进行认证 |  |


  
## timestamp时间戳超时机制  
数据加签，解决了数据报文被人抓包破解问题，却解决不了他人抓包后恶意请求攻击来搞垮系统(比如dos攻击即让目标服务器停止服务)。    
      
我们可以引入时间戳超时机制，来保证接口安全，即：用户每次请求都带上当前时间的时间戳，服务端接收到时间戳后，解密、验签通过后，与服务器当前时间进行对比，如果时间差大于设置的时间，比如2分钟，则任务该请求无效。那在设置的时间差范围内的恶意攻击呢？  

**基于nonce方案**  
nonce的意思是仅一次有效的随机字符串。每次请求时，请求参数不同，比如可根据时间戳来生成，结合其他信息(ip、token等)做个加密处理，作为nonce参数。服务端将每次请求的nonce参数存储到一个集合中，每次处理请求时，从该集合中判断nonce参数是否存在，存在则认为该次请求为非法请求。  

比如：http://xxxxx?userId=ZX07&nonce=58442c21&sign=80b886d71449cb33355d0  
sign = Md5(userId.token.nonce) nonce作为数字签名的一部分，因Md5加密的不可逆性，攻击者不清楚token，所有无法生成新的sign。  

`弊端：`消耗服务器资源用来存储nonce参数集合，因为需要存储设定时间差值内容nonce参数的集合。  



## 限流、黑/白名单机制  

- 限流：真实用户，恶意频繁调用接口，可以使用限流方式，比如redis限流算法，设置一个带过期事件的缓存，根据接口的调用次数，缓存值不断变化，在过期时间范围内如果该缓存值达到了限流阀值，则触发限流后的逻辑错误。  
- 黑名单：发现用户为恶意请求，也可以使用黑名单机制将该用户拉黑，对于黑名单发起的请求，直接返回相应的错误码。  
- 白名单：访问系统，需要提前申请网络白名单，只有在白名单里面的请求，才允许访问。  



## 数据脱敏、参数合法性校验  

数据脱敏是指对某些敏感信息通过脱敏规则进行的数据变形，实现敏感隐私数据的可靠性保护。  

比如常常遇见的身份证、手机号脱敏展示： `36**************13`、`159*****66`  

数据脱敏技术并不需要对所有的信息进行加密，数据脱敏保存了数据原有的格式，在不需要解密的条件下，降低数据敏感度。  

接口数据的安全性保证，还需要我们的系统有个数据合法性校验，简单来说就是参数校验，比如身份证长度、手机号长度、是否为数字等等。